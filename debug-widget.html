<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JotForm Widget Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce5ff; color: #004085; }
        #log {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            border-radius: 8px;
            max-height: 300px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h2>üîß JotForm Widget Debug v2</h2>
    
    <div id="status" class="status info">Checking...</div>
    
    <h3>Debug Log:</h3>
    <div id="log"></div>

    <script>
        function log(msg) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${time}] ${msg}\n`;
            console.log(msg);
        }
        
        function setStatus(type, msg) {
            const el = document.getElementById('status');
            el.className = 'status ' + type;
            el.textContent = msg;
        }
        
        // Log environment info
        log('Page loaded');
        log('URL: ' + window.location.href);
        log('Protocol: ' + window.location.protocol);
        log('In iframe: ' + (window.self !== window.top));
        
        // Check immediately before loading script
        log('JFCustomWidget before script: ' + typeof JFCustomWidget);
        
        // Dynamically load script and track it
        log('Loading JotForm widget script...');
        
        var script = document.createElement('script');
        script.src = 'https://cdn.jotfor.ms/js/JotFormCustomWidget.min.js';
        
        script.onload = function() {
            log('‚úì Script LOADED successfully');
            log('JFCustomWidget after load: ' + typeof JFCustomWidget);
            
            if (typeof JFCustomWidget !== 'undefined') {
                setStatus('success', '‚úÖ JFCustomWidget FOUND!');
                initWidget();
            } else {
                log('Script loaded but JFCustomWidget not defined');
                log('Checking window object...');
                log('window.JFCustomWidget: ' + typeof window.JFCustomWidget);
                
                // List all JF* globals
                var jfVars = Object.keys(window).filter(k => k.startsWith('JF'));
                log('JF* globals found: ' + (jfVars.length ? jfVars.join(', ') : 'none'));
                
                setStatus('error', '‚ùå Script loaded but JFCustomWidget missing');
            }
        };
        
        script.onerror = function(e) {
            log('‚úó Script FAILED to load!');
            log('Error: ' + JSON.stringify(e));
            setStatus('error', '‚ùå Script failed to load');
        };
        
        document.head.appendChild(script);
        
        function initWidget() {
            try {
                JFCustomWidget.sendData({ value: '', valid: true });
                log('sendData() called');
                
                JFCustomWidget.subscribe('ready', function(data) {
                    log('READY event: ' + JSON.stringify(data));
                });
                
                JFCustomWidget.subscribe('submit', function() {
                    log('SUBMIT event');
                    JFCustomWidget.sendSubmit({ value: 'test', valid: true });
                });
                
                log('Widget initialized successfully!');
            } catch (e) {
                log('ERROR initializing: ' + e.message);
            }
        }
    </script>
</body>
</html>
